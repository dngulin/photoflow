import { SpringConfig, SpringState, Spring } from "spring-animation.slint";
import { EveryFrameTimer } from "every-frame-timer.slint";

export component VerticalScrollable inherits Rectangle {
    width: 100%;
    height: 100%;
    clip: true;

    in property <length> contents-w;
    in property <length> contents-h;

    in-out property <length> viewport-x;
    in-out property <length> viewport-y;

    property <SpringState> spring;
    property <SpringConfig> spring-cfg: { stiffness: 700, damping: 40, mass: 1 };

    public function set-spring-scroll-target(target: length) {
        spring = Spring.start(root.viewport-y / 1px, target / 1px, spring.velocity);
    }

    function tick(dt: duration) {
        spring = Spring.update(spring-cfg, spring, dt / 1s);
        self.viewport-y = spring.current-value * 1px;
    }

    if Spring.is-active(spring): EveryFrameTimer {
        triggered(dt) => {
            tick(dt)
        }
    }

    Rectangle {
        x: -root.viewport-x;
        y: -root.viewport-y;
        width: root.contents-w;
        height: root.contents-h;
        @children
    }
}
